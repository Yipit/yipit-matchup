{% extends 'base.html' %}

{% block extra_head %}
<style>
.upset {
    background:#E5FFE5
}
</style>

<script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                type: 'line',
                marginRight: 130,
                marginBottom: 45,
            },
            title: {
                text: 'Daily Games Played',
                x: -20 //center
            },
            xAxis: {
            type: 'datetime',
            maxZoom: 24 * 3600000, // fourteen days
            },
            yAxis: {
                title: {
                    text: '# of games'
                },
            },
            tooltip: {
                shared: true
            },
            series: [{
                name: 'Yipit',
                pointInterval: 24 * 3600 * 1000,
                pointStart: Date.UTC({{start.year}}, {{start.month}}-1, {{start.day}}),
                data: [{% for game in games_by_day %}{{game}},{% endfor %}]
            }]
        });
    });
    
});
        </script>
{% endblock %}

{% block content %}

<div class="row-fluid">
<div class="span6">
<div style="margin-bottom:15px" class="well"><h2> Games Played <a style="float:right" href="{% url add_game %}" class="btn btn-success btn-large">Add Game</a></h2>
</div>

<div class="span8" style="margin-left:0px">
{% regroup games by date.date|date:"D M d" as games_by_day %}
<div id="container" class="span12" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
<div style="padding-bottom: 30px;"><span class="label label-warning">New</span> Green highlighting indicates an upset</div>

{% for day in games_by_day %}
<h4> {{day.grouper}} ({{ day.list|length }} games played)</h4>
<table class="table">

{% for game in day.list %}
<tr class="{% if game.loser.rank < game.winner.rank %}upset{% endif %}">
		<td>{{ game.pretty_time }}</td>
		<td>{{ game.winner.handle }} v. {{ game.loser.handle }}</td>
		<td>{{ game.winning_score }} - {{ game.losing_score }}</td>

</tr>
{% endfor %}
</tbody>
</table>
{% endfor %}
</div>
</div>

<div class="span6">
<div style="margin-bottom:15px" class="well"><h2> Ranking <a style="float:right; font-size:70%" target="_blank" href='http://www.usatt.org/ratings/ratingsprocess.html'>How are players ranked?</a> </h2></div>
<div style="padding-left:7px;padding-top:15px;padding-bottom:5px;"><span class="label label-success">Tip</span> Add a game faster! Just click the winner's name below.</div>
<div style="padding-bottom:30px; padding-left:7px"><span class="label label-warning">New</span> Orange highlighting when player wins 3 or more consecutive games</div>
<table class="table">
<thead>
<tr>
<th>Rank</th>
<th>Player</th>
<th>Points</th>
<th># Games</th>
<th>Win Ratio</th>
</tr>
</thead>
<tbody>
{% for player in ranked_players %}
{% if player.games_played != 0 %}
<tr class="{% if player.on_fire %}alert{% endif %}"> 
<td>{{player.rank}}</td>
<td><a href='{% url add_game %}?opponent={{player.handle}}'>{{player.handle}}</td></a>
<td>{{player.pretty_rating}}</td>
<td>{{player.games_played}}</td>
<td>{{player.win_loss_ratio}}</td>
</tr>
{% endif %}
{% endfor %}
</tbody>
</table>
</div>
</div>

<script src="/media/js/highcharts.js"></script>


{% endblock %}
